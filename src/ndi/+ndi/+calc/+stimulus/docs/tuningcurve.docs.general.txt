NDI_CALCULATOR: ndi.calc.stimulus.tuningcurve

**Description**

The `ndi.calc.stimulus.tuningcurve` calculator computes tuning curves from stimulus response data. It operates on `stimulus_response_scalar` documents, which contain scalar responses (like mean firing rate) to various stimuli. The calculator allows users to define independent variables and sophisticated selection criteria to filter or group stimuli, enabling the extraction of specific tuning relationships (e.g., contrast response functions, orientation tuning curves) from complex, multi-dimensional stimulus sets.

**Methodology**

The calculator identifies a `stimulus_response_scalar` document (specified via `depends_on`) and applies a set of filtering and grouping operations defined in `input_parameters`. The core idea is to build up a selection structure that precisely defines which stimuli to include and how to group them.

**Building a Selection Structure by Example**

To understand how to use this calculator, we will build up a parameter structure for a specific use case: generating a **Contrast Tuning Curve** at the "best" orientation, while creating separate curves for each spatial frequency.

1.  **Define Independent Variables**:
    First, we specify the variable that changes along the x-axis of our tuning curve.
    ```matlab
    parameters.input_parameters.independent_label = 'Contrast';       % Label for the plot/document
    parameters.input_parameters.independent_parameter = 'contrast';   % The actual stimulus parameter name
    ```

2.  **Define Optimization Algorithm**:
    We need to tell the calculator how to determine what is "best" when we ask for the best parameter value.
    ```matlab
    parameters.input_parameters.best_algorithm = 'empirical_maximum'; % Use the value with the highest response
    ```

3.  **Specify Dependency**:
    We identify the source data.
    ```matlab
    parameters.input_parameters.depends_on = struct('name','stimulus_response_scalar_id','value','');
    ```

4.  **Build the Selection Structure**:
    Now we define the `selection` structure array. Each element specifies a `property` (stimulus parameter), an `operation`, and a `value`.

    *   **Step 4a: Fix Orientation to the Best Value**
        We want the contrast tuning curve to be measured at the neuron's preferred orientation. This line says: "use stimuli with the parameter 'angle' whose value exactly matches the stimulus with the best empirical response."
        ```matlab
        parameters.input_parameters.selection(1) = struct('property','angle','operation','exact_number','value','best');
        ```

    *   **Step 4b: Iterate over Spatial Frequencies**
        We want to see how contrast tuning changes with spatial frequency. Instead of picking one frequency, we use the `deal` operation. This line says: "create a different tuning curve document for each unique value of 'sFrequency'."
        ```matlab
        parameters.input_parameters.selection(2) = struct('property','sFrequency','operation','exact_number','value','deal');
        ```

    *   **Step 4c: Verify Parameter Variation**
        It is good practice to ensure the parameters we expect to vary actually do vary in the dataset.

        This line says: "only examine stimulus_parameter documents where the stimuli have the field 'sFrequency' and where this varies across at least some stimulus presentations."
        ```matlab
        parameters.input_parameters.selection(3) = struct('property','sFrequency','operation','hasfield','value','varies');
        ```

        This line says: "only build tuning curves when the associated stimulus_presentation document varies in 'contrast'."
        ```matlab
        parameters.input_parameters.selection(4) = struct('property','contrast','operation','hasfield','value','varies');
        ```

**References**

*   N/A

**Formulas**

*   **Empirical Maximum**: The 'best' value is determined by finding the stimulus condition with the largest mean response magnitude (or absolute magnitude for complex responses).
